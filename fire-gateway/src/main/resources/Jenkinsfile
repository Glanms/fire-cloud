pipeline {
    agent any

    triggers {
        pollSCM('H/1 0 * * *')
    }
    tools {
        maven 'maven-3.10.0'
        jdk 'JDK8'
    }
    options {
        buildDiscarder(logRotator(numToKeepStr: '10'))
    }

    environment {
        _GITHUB_READABLE_CREDENTIALS = 'dcae8179-aec2-4eb5-b6ce-177179d463c5'
    }

    parameters {
        string(defaultValue: "fire-gateway/pom.xml", name:'pomPath', description: 'pom文件相对路径')
        string(defaultValue: 'https://github.com/beifei1/fire-cloud.git', name: 'repoUrl', description: '代码仓库路径')
        string(defaultValue: 'master', name: 'repoBranch', description: '拉取的代码分支')
    }

    stages {
        stage ("代码获取") {
            steps {
                echo "staring fetch code from ${params.repoUrl}..."
                git credentialsId: "${_GITHUB_READABLE_CREDENTIALS}", url: "${params.repoUrl}", branch: "${params.repoBranch}"
                echo "fetch code complete !"
            }
        }

        state ("静态编译") {
            steps {
                echo "编译..."
            }
        }

        stage("单元测试") {
            steps {
                echo  'start junit testing....'
            }
        }

        stage ('应用部署') {
            steps {
                sh "mvn -f ${params.pomPath} clean package deploy -D maven.skip.test=true"
                //这里加入groovy脚本，到ssh
                script {
                }
            }
        }
    }
}